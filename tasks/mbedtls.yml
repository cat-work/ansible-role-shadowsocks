---
- name: download mbedtls
  unarchive:
    src: https://tls.mbed.org/download/mbedtls-{{ mbedtls_ver }}-gpl.tgz
    dest: "{{ workspace }}"
    remote_src: yes
  register: mbedtls_dir

- name: install mbedtls
  block:
    - name: make mbedtls
      command: make SHARED=1 CFLAHS=-fPIC
      args:
        chdir: "{{ workspace }}/mbedtls-{{ mbedtls_ver }}"
    - name: make install
      command: make DESTDIR=/usr install
      args:
        chdir: "{{ workspace }}/mbedtls-{{ mbedtls_ver }}"
    - name: ldconfig
      command: ldconfig

